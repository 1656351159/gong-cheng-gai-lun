{% extends 'base.html' %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h4>材料信息</h4>
  <form class="d-flex" method="get">
    <input class="form-control me-2" name="search" placeholder="按名称搜索" value="{{ request.args.get('search', '') }}">
    <button class="btn btn-outline-secondary" type="submit">搜索</button>
  </form>
</div>
<div class="row">
  <div class="col-md-5">
    <div class="card mb-3">
      <div class="card-body">
        <h5 class="card-title">新增材料</h5>
        <form method="post">
          <div class="mb-3">
            <label class="form-label">名称</label>
            <input class="form-control" name="name" required>
          </div>
          <div class="mb-3">
            <label class="form-label">规格型号</label>
            <input class="form-control" name="specification">
          </div>
          <div class="row">
            <div class="col">
              <label class="form-label">单位</label>
              <input class="form-control" name="unit" value="pcs">
            </div>
            <div class="col">
              <label class="form-label">单价</label>
              <input type="number" step="0.01" class="form-control" name="price" value="0">
            </div>
          </div>
          <div class="row mt-3">
            <div class="col">
              <label class="form-label">安全库存</label>
              <input type="number" class="form-control" name="safety_stock" value="0">
            </div>
            <div class="col">
              <label class="form-label">所属类目</label>
              <select class="form-select" name="category_id">
                <option value="">未分类</option>
                {% for cat in categories %}
                <option value="{{ cat.id }}">{{ cat.name }}</option>
                {% endfor %}
              </select>
            </div>
          </div>
          <div class="mt-3">
            <label class="form-label">描述</label>
            <textarea class="form-control" name="description" rows="2"></textarea>
          </div>
          <button class="btn btn-primary mt-3" type="submit">保存</button>
        </form>
      </div>
    </div>
  </div>
  <div class="col-md-7">
    <div class="table-responsive">
      <table class="table table-striped">
        <thead>
          <tr>
            <th>名称</th>
            <th>规格</th>
            <th>库存</th>
            <th>单位</th>
            <th>单价</th>
            <th>安全库存</th>
          </tr>
        </thead>
        <tbody>
          {% for material in materials %}
          <tr class="{% if material.current_stock < material.safety_stock %}table-warning{% endif %}">
            <td>{{ material.name }}</td>
            <td>{{ material.specification }}</td>
            <td>{{ material.current_stock }}</td>
            <td>{{ material.unit }}</td>
            <td>{{ material.price }}</td>
            <td>{{ material.safety_stock }}</td>
          </tr>
          {% else %}
          <tr><td colspan="6" class="text-center">暂无材料</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
